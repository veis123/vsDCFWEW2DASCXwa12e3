local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local localPlayer = Players.LocalPlayer
local mouse = localPlayer:GetMouse()

local selectedPlayer = nil
local ragdollClone = nil 
local originalCameraSubject = nil
local originalProperties = {}
local savedSkins = {}
local originalUserId = localPlayer.UserId
local flying = false
local flySpeed = 50
local bodyVelocity, bodyGyro

local Window = Rayfield:CreateWindow({
   Name = "NORTCH.GG",
   Icon = 0,
   LoadingTitle = "NORTCH.GG",
   LoadingSubtitle = "by Legion",
   ShowText = "Rayfield",
   Theme = "Default",
   ToggleUIKeybind = "K",
   DisableRayfieldPrompts = false,
   DisableBuildWarnings = false,
   ConfigurationSaving = {
      Enabled = true,
      FolderName = nil,
      FileName = "Big Hub"
   },
   Discord = {
      Enabled = false,
      Invite = "noinvitelink",
      RememberJoins = true
   },
   KeySystem = false,
   KeySettings = {
      Title = "Untitled",
      Subtitle = "Key System",
      Note = "No method of obtaining the key is provided",
      FileName = "Key",
      SaveKey = true,
      GrabKeyFromSite = false,
      Key = {"Hello"}
   }
})

local Tab1 = Window:CreateTab("General", 4483362458)
local Tab2 = Window:CreateTab("Ragdoll", 4483362458) 
local Tab4 = Window:CreateTab("Players", 4483362458)
local Tab3 = Window:CreateTab("Tools", 4483362458)

local DexButton = Tab1:CreateButton({
   Name = "Dex",
   Callback = function()
     pcall(function()
         loadstring(game:HttpGet('https://raw.githubusercontent.com/MassiveHubs/loadstring/refs/heads/main/DexXenoAndRezware'))()
     end)
   end,
})

local Infity = Tab1:CreateButton({
   Name = "Infinite Yield",
   Callback = function()
     pcall(function()
         loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
     end)
   end,
})

local InvisToggle = Tab1:CreateToggle({
   Name = "Invisible",
   CurrentValue = false,
   Flag = "InvisToggle",
   Callback = function(Value)
       local character = localPlayer.Character
       if not character then return end
       
       for _, part in ipairs(character:GetDescendants()) do
           if part:IsA("BasePart") then
               part.Transparency = Value and 1 or (part.Name == "HumanoidRootPart" and 1 or 0)
           elseif part:IsA("Decal") then
               part.Transparency = Value and 1 or 0
           end
       end
   end,
})

local FlyToggle = Tab1:CreateToggle({
   Name = "Fly",
   CurrentValue = false,
   Flag = "FlyToggle",
   Callback = function(Value)
       flying = Value
       local character = localPlayer.Character
       if not character or not character:FindFirstChild("HumanoidRootPart") then return end
       local humanoidRootPart = character.HumanoidRootPart
       
       if flying then
           bodyVelocity = Instance.new("BodyVelocity")
           bodyVelocity.Velocity = Vector3.new(0, 0, 0)
           bodyVelocity.MaxForce = Vector3.new(9e9, 9e9, 9e9)
           bodyVelocity.Parent = humanoidRootPart
           
           bodyGyro = Instance.new("BodyGyro")
           bodyGyro.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
           bodyGyro.CFrame = humanoidRootPart.CFrame
           bodyGyro.Parent = humanoidRootPart
           
           local humanoid = character:FindFirstChild("Humanoid")
           if humanoid then
               humanoid.PlatformStand = true
           end
           
           spawn(function()
               local camera = workspace.CurrentCamera
               while flying do
                   local moveDirection = Vector3.new(0, 0, 0)
                   
                   if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.W) then
                       moveDirection = moveDirection + (camera.CFrame.LookVector * flySpeed)
                   end
                   if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.S) then
                       moveDirection = moveDirection - (camera.CFrame.LookVector * flySpeed)
                   end
                   if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.A) then
                       moveDirection = moveDirection - (camera.CFrame.RightVector * flySpeed)
                   end
                   if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.D) then
                       moveDirection = moveDirection + (camera.CFrame.RightVector * flySpeed)
                   end
                   if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.Space) then
                       moveDirection = moveDirection + Vector3.new(0, flySpeed, 0)
                   end
                   if game:GetService("UserInputService"):IsKeyDown(Enum.KeyCode.LeftShift) then
                       moveDirection = moveDirection - Vector3.new(0, flySpeed, 0)
                   end
                   
                   if bodyVelocity then
                       bodyVelocity.Velocity = moveDirection
                   end
                   if bodyGyro then
                       bodyGyro.CFrame = camera.CFrame
                   end
                   
                   wait()
               end
           end)
       else
           if bodyVelocity then
               bodyVelocity:Destroy()
               bodyVelocity = nil
           end
           if bodyGyro then
               bodyGyro:Destroy()
               bodyGyro = nil
           end
           local humanoid = character:FindFirstChild("Humanoid")
           if humanoid then
               humanoid.PlatformStand = false
           end
       end
   end,
})

local jerkoff = Tab3:CreateButton({
   Name = "Jerf Off",
   Callback = function()
      local character = localPlayer.Character
      if not character then return end
      
      pcall(function()
          if character.Humanoid.RigType == Enum.HumanoidRigType.R15 then
              loadstring(game:HttpGet("https://pastefy.app/YZoglOyJ/raw"))()
          else
             loadstring(game:HttpGet("https://pastefy.app/wa3v2Vgm/raw"))()
          end
      end)
   end,
})

local Input = Tab2:CreateInput({
   Name = "Change Avatar",
   CurrentValue = "",
   PlaceholderText = "Player id or name",
   RemoveTextAfterFocusLost = false,
   Flag = "Input1",
   Callback = function(Text)
      Text = Text:gsub("^%s*", ""):gsub("%s*$", "")
      if Text == "" then return end

      local targetUserId
      local isUserId = tonumber(Text)

      if isUserId then
         targetUserId = isUserId
      else
         local success, result = pcall(function()
            return Players:GetUserIdFromNameAsync(Text)
         end)
         if success and result then
            targetUserId = result
         else
            return
         end
      end
      
      local character = localPlayer.Character
      if not character or not character.PrimaryPart then
         return
      end

      local currentCFrame = character.PrimaryPart.CFrame
      
      local success, err = pcall(function()
          ReplicatedStorage.PlayerAppearanceEvent:FireServer(targetUserId)
      end)
      if not success then
          return
      end
      
      local newCharacter = localPlayer.CharacterAdded:Wait()
      newCharacter:WaitForChild("HumanoidRootPart")
      newCharacter.HumanoidRootPart.CFrame = currentCFrame
   end
})

local ResetSkin = Tab2:CreateButton({
   Name = "Reset Skin",
   Callback = function()
      local character = localPlayer.Character
      if not character or not character.PrimaryPart then return end
      local currentCFrame = character.PrimaryPart.CFrame
      pcall(function()
         ReplicatedStorage.PlayerAppearanceEvent:FireServer(originalUserId)
      end)
      local newCharacter = localPlayer.CharacterAdded:Wait()
      newCharacter:WaitForChild("HumanoidRootPart")
      newCharacter.HumanoidRootPart.CFrame = currentCFrame
   end,
})

local UnRagdol = Tab2:CreateToggle({
   Name = "UnRagdol",
   CurrentValue = false,
   Flag = "Toggle1",
   Callback = function(Value)
      local character = localPlayer.Character
      if not character then return end

      if Value then
         local ragdollInstance = character:FindFirstChild("Local Ragdoll")
         if ragdollInstance then
            if ragdollClone == nil then
               ragdollClone = ragdollInstance:Clone()
            end
            ragdollInstance:Destroy()
         end
      else
         if ragdollClone and not character:FindFirstChild("Local Ragdoll") then
            local newRagdoll = ragdollClone:Clone()
            newRagdoll.Parent = character
         end
      end
   end,
})

local SkinDropdown = Tab2:CreateDropdown({
   Name = "Saved Skins",
   Options = {},
   CurrentOption = {},
   MultipleOptions = false,
   Flag = "SkinDropdown",
   Callback = function(Options)
      local selectedSkinName = Options[1]
      if selectedSkinName and savedSkins[selectedSkinName] then
         local targetUserId = savedSkins[selectedSkinName]
         local character = localPlayer.Character
         if not character or not character.PrimaryPart then return end
         local currentCFrame = character.PrimaryPart.CFrame
         pcall(function()
            ReplicatedStorage.PlayerAppearanceEvent:FireServer(targetUserId)
         end)
         local newCharacter = localPlayer.CharacterAdded:Wait()
         newCharacter:WaitForChild("HumanoidRootPart")
         newCharacter.HumanoidRootPart.CFrame = currentCFrame
      end
   end,
})

local NameLabel = Tab4:CreateLabel("None")

local function setCharacterGhost(character, isGhost)
    if not character then return end
    for _, part in ipairs(character:GetDescendants()) do
        if part:IsA("BasePart") or part:IsA("Decal") then
            if isGhost then
                if not originalProperties[part] then
                    originalProperties[part] = {Transparency = part.Transparency, CanCollide = part.CanCollide}
                end
                part.Transparency = 1
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            else
                local props = originalProperties[part]
                if props then
                    part.Transparency = props.Transparency
                    if part:IsA("BasePart") then
                        part.CanCollide = props.CanCollide
                    end
                end
            end
        end
    end
    if not isGhost then
        originalProperties = {}
    end
end

local Goto = Tab4:CreateButton({
   Name = "Goto",
   Callback = function()
       if not selectedPlayer then return end
       local localCharacter = localPlayer.Character
       local targetCharacter = selectedPlayer.Character
       if localCharacter and localCharacter:FindFirstChild("HumanoidRootPart") and targetCharacter and targetCharacter:FindFirstChild("HumanoidRootPart") then
           localCharacter.HumanoidRootPart.CFrame = targetCharacter.HumanoidRootPart.CFrame
       end
   end,
})

local SpectateToggle = Tab4:CreateToggle({
   Name = "Spectate",
   CurrentValue = false,
   Flag = "SpectateToggle",
   Callback = function(Value)
       if Value then
           if not selectedPlayer or not selectedPlayer.Character or not selectedPlayer.Character:FindFirstChild("Humanoid") then
               return
           end
           
           originalCameraSubject = workspace.CurrentCamera.CameraSubject
           workspace.CurrentCamera.CameraSubject = selectedPlayer.Character.Humanoid
           setCharacterGhost(localPlayer.Character, true)
       else
           if originalCameraSubject then
               workspace.CurrentCamera.CameraSubject = originalCameraSubject
           end
           setCharacterGhost(localPlayer.Character, false)
       end
   end,
})

local CopySkin = Tab4:CreateButton({
   Name = "Copy Skin",
   Callback = function()
       if selectedPlayer then
           local targetUserId = selectedPlayer.UserId
           local targetName = selectedPlayer.Name
           
           savedSkins[targetName] = targetUserId
           
           local skinList = {}
           for name, _ in pairs(savedSkins) do
               table.insert(skinList, name)
           end
           
           SkinDropdown:Refresh(skinList)
           
           local character = localPlayer.Character
           if not character or not character.PrimaryPart then return end
           local currentCFrame = character.PrimaryPart.CFrame
           pcall(function()
               ReplicatedStorage.PlayerAppearanceEvent:FireServer(targetUserId)
           end)
           local newCharacter = localPlayer.CharacterAdded:Wait()
           newCharacter:WaitForChild("HumanoidRootPart")
           newCharacter.HumanoidRootPart.CFrame = currentCFrame
       end
   end,
})

local localScript = localPlayer.PlayerScripts:FindFirstChild("LocalScript")
if localScript then
    localScript.Enabled = false
end

mouse.Button1Down:Connect(function()
	local target = mouse.Target
	if not target then return end

	local characterModel = target:FindFirstAncestorWhichIsA("Model")
	if characterModel and characterModel:FindFirstChild("Humanoid") then
		local targetPlayer = Players:GetPlayerFromCharacter(characterModel)
		
		if targetPlayer and targetPlayer ~= localPlayer then
			selectedPlayer = targetPlayer
			NameLabel:Set(selectedPlayer.Name)
		end
	end
end)
